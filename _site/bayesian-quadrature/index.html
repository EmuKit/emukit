<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.5.0 --> <title>Bayesian Quadrature | Emukit</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="Bayesian Quadrature" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Bayesian quadrature is an active learning method for the value of an integral given queries of the integrand on a finite and usually small amount of input locations." /> <meta property="og:description" content="Bayesian quadrature is an active learning method for the value of an integral given queries of the integrand on a finite and usually small amount of input locations." /> <link rel="canonical" href="http://localhost:4000/emukit/bayesian-quadrature/" /> <meta property="og:url" content="http://localhost:4000/emukit/bayesian-quadrature/" /> <meta property="og:site_name" content="Emukit" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2016-06-09T00:00:00+01:00" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <script type="application/ld+json"> {"url":"http://localhost:4000/emukit/bayesian-quadrature/","dateModified":"2016-06-09T00:00:00+01:00","datePublished":"2016-06-09T00:00:00+01:00","headline":"Bayesian Quadrature","description":"Bayesian quadrature is an active learning method for the value of an integral given queries of the integrand on a finite and usually small amount of input locations.","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/emukit/bayesian-quadrature/"},"@type":"BlogPosting","@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"> --> <link rel="stylesheet" href="/emukit/css/main.css"> <link rel="alternate" type="application/rss+xml" title="Emukit" href="http://localhost:4000/emukit/feed.xml"> <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> </head> <body> <header class="site-header"> <nav class="navbar navbar-default"> <div class="container-fluid"> <!-- Brand and toggle get grouped for better mobile display --> <div class="navbar-header"> <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <a class="navbar-brand" href="/emukit/">Emukit</a> </div> <!-- Collect the nav links, forms, and other content for toggling --> <div class="collapse navbar-collapse " id="bs-example-navbar-collapse-1"> <ul class="nav navbar-nav navbar-right"> <li><a href="/emukit/about/">About</a></li> <li><a href="http://nbviewer.jupyter.org/github/amzn/emukit/blob/develop/notebooks/index.ipynb">Tutorials</a></li> <li><a href="https://github.com/amzn/emukit/tree/develop/emukit/examples">Examples</a></li> <li class="dropdown"> <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Resources<span class="caret"></span></a> <ul class="dropdown-menu"> <li><a href="/emukit/installation/">Installation</a></li> <li role="separator" class="divider"></li> <li><a href="https://emukit.readthedocs.io/en/latest/">Documentation</a></li> <li><a href="https://emukit.readthedocs.io/en/latest/api/emukit.html">API reference</a></li> <li role="separator" class="divider"></li> <li><a href="/emukit/citation/">Citation</a></li> <li><a href="/emukit/news/">News</a></li> </ul> <li><a href="https://github.com/amzn/emukit">Github</a></li> </li> </ul> </div><!-- /.navbar-collapse --> </div><!-- /.container-fluid --> </nav> </header> <div class="container"> <div class="wrapper"> <div class="row"> <div class="col-md-8"> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"> <h1 class="post-title" itemprop="name headline">Bayesian Quadrature</h1> <p class="post-meta"></p> </header> <div class="post-content" itemprop="articleBody"> <p>Bayesian quadrature is an active learning method for the value of an integral given queries of the integrand on a finite and usually small amount of input locations.</p> <p>Bayesian quadrature <a href="#refereces-on-quadrature">[1, 2]</a> returns not only an estimator, but a full posterior distribution on the integral value which can subsequently be used in decision making or uncertainty analysis.</p> <p>Bayesian quadrature is especially useful when integrand evaluations are expensive and sampling schemes prohibitive, for example when evaluating the integrand involves running a complex computer simulation, a real-world experiment, or a lab. But even when evaluation cost is manageable, the sheer amount of queries that might be required by classical algorithms is usually incentive enough to favor a smarter and less wasteful approach.</p> <p>Instead, Bayesian quadrature draws information from structure encoded as prior over the function space modeling the integrand, such as regularity or smoothness, and is thus able to learn faster from fewer datapoints (function evaluations). In Emukit, the surrogate model for the integrand would be the <em>emulator</em> and the integrand that can be queried, and possibly describes a real, complex system, the <em>simulator</em>.</p> <h4 id="bayesian-quadrature-in-the-loop">Bayesian Quadrature in the Loop</h4> <p>Like other sequential learning schemes, Bayesian quadrature iteratively selects points where the integrand will be queried next such that an acquisition function (e.g., the reduction of the integral variance) is maximized in each step. At the same time, the model class (often a Gaussian process) is updated with the newly collected datapoint and refined at each step by optimizing its hyperparameters. The actual integration that yields the distribution over the integral value is then performed by integrating the emulator of the integrand function, which is often analytic for certain choices of Gaussian processes, or an analytic approximation (e.g., for WSABI <a href="#refereces-on-quadrature">[3]</a>).</p> <p>Thus, the success of Bayesian quadrature is based on three things: i) replacing an intractable integral with a regression problem on the integrand function ii) replacing the actual integration with an easier, analytic integration of the surrogate model on the integrand function, and iii) actively choosing locations for integrand evaluations such that the budget is optimally used in the sense encoded by the acquisition scheme.</p> <h4 id="bayesian-quadrature-in-emukit">Bayesian Quadrature in Emukit</h4> <p>Emukit at the moment provides basic functionality for vanilla Bayesian quadrature where a Gaussian process surrogate model is placed upon the integrand which is then integrated directly. This is how it is done:</p> <p>First we define the function that we want to integrate, also called the <em>integrand</em>. Here we choose the 1-dimensional Hennig1D function (see <a href="http://nbviewer.jupyter.org/github/amzn/emukit/blob/develop/notebooks/Emukit-tutorial-Bayesian-quadrature-introduction.ipynb">here</a> for a visualization) which is already implemented in Emukit. We also choose the integration bounds: a lower bound and an upper bound.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">emukit.test_functions</span> <span class="kn">import</span> <span class="n">hennig1D</span>

<span class="n">user_function</span> <span class="o">=</span> <span class="n">hennig1D</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lb</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.</span> <span class="c1"># lower integral bound
</span><span class="n">ub</span> <span class="o">=</span> <span class="mf">3.</span> <span class="c1"># upper integral bound
</span></code></pre></div></div> <p>Next we choose three locations for some initial evaluations to get an initial model of the integrand, also called the initial design. Here we use the GP regression model of <a href="https://github.com/SheffieldML/GPy">GPy</a> since a wrapper already exists in Emukit. Note that in BQ we are usually restricted in the choice of the kernel function. Emukit at the moment supports the RBF/Gaussian kernel for Bayesian quadrature.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">GPy</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">2.</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">]])</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">user_function</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># inital integrand evaluations at locations X 
</span><span class="n">gpy_model</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">GPRegression</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> 
                                    <span class="n">kernel</span><span class="o">=</span><span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                                    <span class="n">lengthscale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> 
                                    <span class="n">variance</span><span class="o">=</span><span class="mf">1.0</span><span class="p">))</span>
</code></pre></div></div> <p>Now we convert the <a href="https://github.com/SheffieldML/GPy">GPy</a> GP model into an Emukit quadrature GP. Note that we also need to wrap the RBF kernel of the GPy model since Bayesian quadrature essentially integrates the kernel function.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">emukit.quadrature.kernels</span> <span class="kn">import</span> <span class="n">QuadratureRBF</span>
<span class="kn">from</span> <span class="nn">emukit.model_wrappers.gpy_quadrature_wrappers</span> <span class="kn">import</span> <span class="n">RBFGPy</span><span class="p">,</span> \
<span class="n">BaseGaussianProcessGPy</span>

<span class="n">emukit_rbf</span> <span class="o">=</span> <span class="n">RBFGPy</span><span class="p">(</span><span class="n">gpy_model</span><span class="o">.</span><span class="n">kern</span><span class="p">)</span>
<span class="n">emukit_qrbf</span> <span class="o">=</span> <span class="n">QuadratureRBF</span><span class="p">(</span><span class="n">emukit_rbf</span><span class="p">,</span> <span class="n">integral_bounds</span><span class="o">=</span><span class="p">[(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)])</span>
<span class="n">emukit_model</span> <span class="o">=</span> <span class="n">BaseGaussianProcessGPy</span><span class="p">(</span><span class="n">kern</span><span class="o">=</span><span class="n">emukit_qrbf</span><span class="p">,</span> <span class="n">gpy_model</span><span class="o">=</span><span class="n">gpy_model</span><span class="p">)</span>
</code></pre></div></div> <p>There are several Bayesian quadrature methods out there. Emukit at the moment supports vanilla Bayesian quadrature where the GP model is directly placed over the integrand function and then integrated analytically. Note that the integration method is different from the GP model, for example other approaches (e.g., <a href="#refereces-on-quadrature">[3]</a>) first transform the GP model before they integrate it.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">emukit.quadrature.methods</span> <span class="kn">import</span> <span class="n">VanillaBayesianQuadrature</span>

<span class="n">emukit_method</span> <span class="o">=</span> <span class="n">VanillaBayesianQuadrature</span><span class="p">(</span><span class="n">base_gp</span><span class="o">=</span><span class="n">emukit_model</span><span class="p">)</span>
</code></pre></div></div> <p>Now we define the active learning loop. The essential piece in the loop is the acquisition function. The vanilla BQ loop by default uses the integral-variance-reduction acquisition (IVR) which is a global quantity of the space.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">emukit.quadrature.loop</span> <span class="kn">import</span> <span class="n">VanillaBayesianQuadratureLoop</span>

<span class="n">emukit_loop</span> <span class="o">=</span> <span class="n">VanillaBayesianQuadratureLoop</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">emukit_method</span><span class="p">)</span>
</code></pre></div></div> <p>Finally, we run the loop for <code class="highlighter-rouge">num_iter = 20</code> iterations. This will collect 20 additional observations, chosen by optimizing the acqusition function at every step. After each newly collected observations, the vanilla BQ model is updated and fitted to the new dataset.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_iter</span> <span class="o">=</span> <span class="mi">20</span>          
<span class="n">emukit_loop</span><span class="o">.</span><span class="n">run_loop</span><span class="p">(</span><span class="n">user_function</span><span class="o">=</span><span class="n">hennig1D</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stopping_condition</span><span class="o">=</span><span class="n">num_iter</span><span class="p">)</span>
</code></pre></div></div> <p>And that’s it! You can retrieve the integral and variance estimator by running</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">integral_mean</span><span class="p">,</span> <span class="n">integral_variance</span> <span class="o">=</span> <span class="n">emukit_loop</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">integrate</span><span class="p">()</span>
</code></pre></div></div> <p>Check our list of <a href="http://nbviewer.jupyter.org/github/amzn/emukit/blob/develop/notebooks/index.ipynb">notebooks</a> and <a href="https://github.com/amzn/emukit/tree/develop/emukit/examples">examples</a> if you want to learn more about how to do Bayesian quadrature and other methods with Emukit. You can also check the Emukit <a href="https://emukit.readthedocs.io/en/latest/">documentation</a>.</p> <p>We’re always open to contributions! Please read our <a href="https://github.com/amzn/emukit/blob/develop/CONTRIBUTING.md">contribution guidelines</a> for more information. We are particularly interested in contributions regarding examples and tutorials.</p> <h4 id="refereces-on-quadrature">Refereces on Quadrature</h4> <ul> <li>[1] O’Hagan (1991) <a href="https://www.sciencedirect.com/science/article/pii/037837589190002V">Bayes-Hermite Quadrature</a>, <em>Journal of Statistical Planning and Inference</em> 29, pp. 245–260.</li> <li>[2] Diaconis (1988) <a href="http://probabilistic-numerics.org/assets/pdf/Diaconis_1988.pdf">Bayesian numerical analysis</a>, <em>Statistical decision theory and related topics</em> V, pp. 163–175.</li> <li>[3] Gunter et al. (2014) <a href="https://papers.nips.cc/paper/5483-sampling-for-inference-in-probabilistic-models-with-fast-bayesian-quadrature">Sampling for Inference in Probabilistic Models with Fast Bayesian Quadrature</a>, <em>Advances in Neural Information Processing Systems</em>, 27, pp. 2789–2797.</li> </ul> </div> </article> <div class="row"> </div> <div class="row"> <ul class="pager"> <li><a class="next" href="/emukit/experimental-design/">&laquo; Experimental design</a></li> <li><a class="previous" href="/emukit/sensitivity-analysis/">Sensitivity Analysis &raquo;</a></li> </ul> </div> </div> <div class="col-md-4 mt20"> <div class="post-img"> <img width="600" src="/emukit/images/bayesian_quadrature.png" alt="Bayesian Quadrature"> </div> <div class="mt10 recent"> <h2>Also in Emukit</h2> <ul> <li> <p><a href="/emukit/emukit-playground/">Emukit-playground</a></p> </li> <li> <p><a href="/emukit/bayesian-optimization/">Bayesian Optimization</a></p> </li> <li> <p><a href="/emukit/multifidelity-emulation/">Multi-fidelity emulation</a></p> </li> </ul> </div> </div> </div> </div> </div> <footer> <div class="container"> <div class="row p20"> <div class="col-md-4 text-center mt25"> <a target="_blank" href="http://twitter.com/@emukitUQ"><li class="social twitter"><i class="fa fa-twitter-square"></i></li></a> <a target="_blank" href="https://github.com/amzn/emukit"><li class="social github"><i class="fa fa-github-square"></i></li></a> </div> </div> </div> </footer> <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script> <script src="/emukit/js/bootstrap.min.js"></script> <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
